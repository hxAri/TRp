
name: "price-tracker"
on:
    push:
        branches:
            -   main
    schedule: 
        #            You can use https://crontab.guru to help generate
        #            your cron syntax and confirm what time it will run
        #            ┌───────────── minute 0, 30
        #            │    ┌───────────── hour (0 - 23)
        #            │    │ ┌───────────── day of the month (1 - 31)
        #            │    │ │ ┌───────────── month (1 - 12 or JAN-DEC)
        #            │    │ │ │ ┌───────────── day of the week (0 - 6 or SUN-SAT)
        #            │    │ │ │ │
        #            0,30 * * * *
        -   cron:  "0,30 * * * *"
jobs:
    tracker:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout v2
                uses: actions/checkout@v2
            -   name: Import GPG key
                id: import-gpg
                uses: crazy-max/ghaction-import-gpg@v4
                with:
                    gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
                    passphrase: ${{ secrets.PASSPHRASE }}
                    git_user_signingkey: true
                    git_commit_gpgsign: true
            -   name: Checkout v3
                uses: actions/checkout@v3
            -   uses: actions/setup-python@v4
                with:
                    python-version: 3.11
                    cache: pip
            -   run: pip install -r requirements.txt
            -   name: Pulling API progress
                run: |
                    export PYTHONPATH=.:$PYTHONPATH
                    python3 src/main
            -   name: Sign commit and push changes
                run: |
                    now=$(date +"%Y-%m-%d %H:%M UTC")
                    git config --global user.name hxari
                    git config --global user.email 90847846+hxAri@users.noreply.github.com
                    git add ./public
                    git commit -S -m "[BOT] Sign commit and push changes ${now}" || echo -e "Nothing to commit"
                    git push || echo "Nothing to push"
